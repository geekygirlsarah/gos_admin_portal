{% extends 'base.html' %}
{% load static %}
{% block title %}Student Emergency Contacts{% endblock %}
{% block content %}
<div class="row mb-3">
  <div class="col"><h1 class="h3">Emergency Contacts</h1></div>
  <div class="col-auto d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'student_list' %}">All Students</a>
  </div>
</div>

{% if students %}
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Student</th>
          <th>School</th>
          <th>Student Phone</th>
          <th>Student Email</th>
          <th>Parent/Guardian 1</th>
          <th>Parent/Guardian 1 Phone</th>
          <th>Parent/Guardian 1 Email</th>
          <th>Parent/Guardian 2</th>
          <th>Parent/Guardian 2 Phone</th>
          <th>Parent/Guardian 2 Email</th>
        </tr>
      </thead>
      <tbody>
        {% for s in students %}
          {% with plist=s.parents.all p1=plist.0 p2=plist.1 %}
          <tr>
            <td>
              <a class="text-decoration-none" href="{% url 'student_detail' s.pk %}?next={{ request.path }}">{{ s.first_name|default:s.legal_first_name }} {{ s.last_name }}</a>
            </td>
            <td>{{ s.school|default:"" }}</td>
            <td>{{ s.cell_phone_number|default:"" }}</td>
            <td>
              {% if s.personal_email %}<div>{{ s.personal_email }}</div>{% endif %}
              {% if s.andrew_email %}<div class="text-muted small">{{ s.andrew_email }}</div>{% endif %}
            </td>
            <td>{% if p1 %}{{ p1 }}{% endif %}</td>
            <td>{% if p1 %}{{ p1.phone_number|default_if_none:"" }}{% endif %}</td>
            <td>{% if p1 %}{{ p1.email|default_if_none:"" }}{% endif %}</td>
            <td>{% if p2 %}{{ p2 }}{% endif %}</td>
            <td>{% if p2 %}{{ p2.phone_number|default_if_none:"" }}{% endif %}</td>
            <td>{% if p2 %}{{ p2.email|default_if_none:"" }}{% endif %}</td>
          </tr>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">No students found.</div>
{% endif %}
{% endblock %}
