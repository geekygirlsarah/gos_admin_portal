{% extends 'base.html' %}
{% load static %}
{% block title %}Payment Receipt — {{ student.first_name|default:student.legal_first_name }} {{ student.last_name }} — {{ program.name }}{% endblock %}
{% block extra_head %}
    <style>
        /* Hide the site navbar on the receipt page (screen and print) */
        nav, .navbar {
            display: none !important;
        }

        @media print {
            .no-print, .alert {
                display: none !important;
            }

            main.container {
                padding: 0 !important;
            }

            .card {
                border: none;
            }
        }

        .org-header {
            margin-bottom: .75rem;
        }

        .receipt-header {
            border-bottom: 2px solid #000;
            margin-bottom: 1rem;
            padding-bottom: .5rem;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-10 col-xl-8 text-end">
            <button class="btn btn-primary no-print " onclick="window.print()">Print</button>
        </div>
    </div>

    <div class="row">
      <div class="col-lg-10 col-xl-8 mb-3">
        <div class="org-header text-end">
            <img src="{% static 'img/cmu-text-logo.png' %}" alt="Carnegie Mellon University logo" class="img-fluid" style="max-width: 250px;">
            <div class="fw-bold">Girls of Steel Robotics</div>
            <div>Carnegie Mellon University</div>
            <div class="mb-2">EIN: 25-0969449</div>
            <div>5000 Forbes Ave</div>
            <div class="mb-2">Pittsburgh, PA 15213-3890</div>
            <div>cmu.edu</div>
        </div>

        <div class="d-flex justify-content-between align-items-start receipt-header">
            <div>
                <h1 class="h4 mb-1">Payment Receipt</h1>
                <div class="text-muted small">Date issued: {% now 'Y-m-d H:i' %}</div>
            </div>
        </div>

        <div class="mb-3">
          <div><span class="fw-semibold">Program:</span> {{ program.name }} -- {{ program.year }}</div>
          <div class="mb-2"><span class="fw-semibold">Participant's name:</span> {{ student.legal_first_name|default:student.first_name }} {{ student.last_name }}{% if student.date_of_birth %} <span class="text-muted small js-age" data-dob="{{ student.date_of_birth|date:'Y-m-d' }}">(Age: --)</span>{% endif %}</div>
            <div><span class="fw-semibold">Parent(s)/Guardian(s) names:</span>
                {% if student.primary_contact or student.secondary_contact %}
                    {% if student.primary_contact %}{{ student.primary_contact }}{% endif %}
                    {% if student.secondary_contact %}
                        {% if student.primary_contact %}, {% endif %}{{ student.secondary_contact }}
                    {% endif %}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>
            <div class="mb-2"><span class="fw-semibold">Address:</span>
                {% if student.primary_contact or student.secondary_contact %}
                    {{ student.address }}, {{ student.city }} {{ student.state }} {{ student.zip_code }}
                {% else %}
                    <span class="text-muted">Not provided</span>
                {% endif %}
            </div>

          <div class="card">
            <div class="card-body">
              <dl class="row mb-0">
                <dt class="col-sm-4">Fee</dt>
                <dd class="col-sm-8">{{ payment.fee.name }}</dd>

                <dt class="col-sm-4">Amount Paid</dt>
                <dd class="col-sm-8">${{ payment.amount|floatformat:2 }}</dd>

                <dt class="col-sm-4">Date Paid</dt>
                <dd class="col-sm-8">{{ payment.paid_on }}</dd>

                <dt class="col-sm-4">Payment Method</dt>
                <dd class="col-sm-8">{{ payment.get_paid_via_display }}</dd>

                {% if payment.check_number %}
                <dt class="col-sm-4">Check Number</dt>
                <dd class="col-sm-8">{{ payment.check_number }}</dd>
                {% endif %}

                {% if payment.camp_hours %}
                <dt class="col-sm-4">Camp Hours</dt>
                <dd class="col-sm-8">{{ payment.camp_hours }}</dd>
                {% endif %}

                {% if payment.notes %}
                <dt class="col-sm-4">Notes</dt>
                <dd class="col-sm-8">{{ payment.notes|linebreaksbr }}</dd>
                {% endif %}

              </dl>
            </div>
          </div>
        </div>

          <div class="">If there are any questions, please contact us at leads@girlsofsteelrobotics.org.</div>

          <div class="mt-4 small text-muted">
          Thank you for your support! Please keep this receipt for your records.
        </div>
      </div>
    </div>
    <script>
      (function() {
        function calcAge(dobStr) {
          var dob = new Date(dobStr + 'T00:00:00');
          if (isNaN(dob.getTime())) return null;
          var today = new Date();
          var age = today.getFullYear() - dob.getFullYear();
          var m = today.getMonth() - dob.getMonth();
          if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
            age--;
          }
          return age;
        }
        var nodes = document.querySelectorAll('.js-age[data-dob]');
        nodes.forEach(function(n) {
          var dob = n.getAttribute('data-dob');
          var age = calcAge(dob);
          if (age !== null && age >= 0) {
            n.textContent = '(Age: ' + age + ')';
          } else {
            n.textContent = '';
          }
        });
      })();
    </script>
{% endblock %}
