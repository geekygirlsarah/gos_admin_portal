{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Sign-out Sheet — {{ program.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .table th, .table td { border-color: #000 !important; border-width: 2px; }
        }
        .table th, .table td { border-width: 2px; }
        body { background: #fff; }
        .sheet-header { margin: 16px 0 12px; }
        .sheet-subtitle { color: #6c757d; }
        .table-header { font-size: 1.25rem; }
        .sig-row { height: 50px; }

        .col-student { width: 7%; }
        .col-adults { width: 24%; }
        .col-present { width: 6%; }
        .col-pickup-adult { width: 28%; }
        .col-sign { width: 28%; }
    </style>
</head>
<body class="container-fluid py-3">
    <div class="no-print mb-3 d-flex gap-2 align-items-center">
        <a class="btn btn-outline-secondary" href="{% url 'program_detail' program.id %}">Back to Program</a>
        <button class="btn btn-primary" onclick="window.print()">Print</button>
    </div>

    <div class="sheet-header">
        <h1 class="h4 mb-1">{{ program.name }} {{ program.year }}— Sign-out Sheet</h1>
        <h2 class="h4 sheet-subtitle">Date: <span id="today"></span></h2>
    </div>

    {% if students %}
    <table class="table table-bordered align-middle">
        <thead>
            <tr>
                <th class="table-header col-student">Student Last</th>
                <th class="table-header col-student">Student First</th>
                <th class="table-header col-adults">Approved Pickup Adults</th>
                <th class="table-header col-present"><span class="small">Present?</span></th>
                <th class="table-header col-pickup-adult">Pickup Adult</th>
                <th class="table-header col-sign">Parent/Guardian Signature</th>
            </tr>
        </thead>
        <tbody>
        {% for s in students %}
            <tr class="sig-row">
                <td>
                    {{ s.last_name }}
                </td>
                <td>
                    {{ s.first_name|default:s.legal_first_name }}
                </td>
                <td>
                    {% for p in s.all_parents %}
                        <div class="mb-1">
                            {{ p.preferred_first_name|default:p.first_name }} {{ p.last_name }}
                            {% if p.phone_number %} — {{ p.phone_number }}{% endif %}
                        </div>
                    {% endfor %}
                </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-info">No students enrolled.</div>
    {% endif %}

    <script>
        (function(){
            const d = new Date();
            const opts = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('today').textContent = d.toLocaleDateString(undefined, opts);
        })();
    </script>
</body>
</html>
