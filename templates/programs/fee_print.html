{% extends 'base.html' %}
{% load static %}
{% block title %}Fee — {{ fee.name }} — {{ program.name }}{% endblock %}
{% block extra_head %}
    <style>
        /* Hide the site navbar on the receipt page (screen and print) */
        nav, .navbar {
            display: none !important;
        }

        @media print {
            .no-print, .alert {
                display: none !important;
            }

            main.container {
                padding: 0 !important;
            }

            .card {
                border: none;
            }
        }

        .org-header {
            margin-bottom: .75rem;
        }

        .receipt-header {
            border-bottom: 2px solid #000;
            margin-bottom: 1rem;
            padding-bottom: .5rem;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-10 col-xl-8 text-end">
            <button class="btn btn-primary no-print" onclick="window.print()">Print</button>
        </div>
    </div>

    <div class="row">
    <div class="col-lg-10 col-xl-8 mb-3">
        <div class="org-header text-end">
            <img src="{% static 'img/cmu-text-logo.png' %}" alt="Carnegie Mellon University logo" class="img-fluid"
                 style="max-width: 250px;">
            <div class="fw-bold">Girls of Steel Robotics</div>
            <div>Carnegie Mellon University</div>
            <div class="mb-2">EIN: 25-0969449</div>
            <div>5000 Forbes Ave</div>
            <div class="mb-2">Pittsburgh, PA 15213-3890</div>
            <div>cmu.edu</div>
        </div>

        <div class="d-flex justify-content-between align-items-start receipt-header">
            <div>
                <h1 class="h4 mb-1">Program Fee</h1>
                <div class="text-muted small">Date issued: {% now 'Y-m-d H:i' %}</div>
            </div>
        </div>

        <div class="mb-3">
            <div><span class="fw-semibold">Program:</span> {{ program.name }} -- {{ program.year }}</div>
            <div class="mb-2"><span class="fw-semibold">Fee name:</span> {{ fee.name }}</div>
            <div><span class="fw-semibold">Amount:</span> ${{ fee.amount|floatformat:2 }}</div>
            <div class="mb-2"><span class="fw-semibold">Date:</span> {{ fee.date|default:fee.created_at|date:'Y-m-d' }}</div>
        </div>

        {% if assigned_students %}
            <div class="mb-3">
                <div class="fw-semibold">Assigned Students:</div>
                <ul>
                {% for s in assigned_students %}
                    <li>{{ s.first_name|default:s.legal_first_name }} {{ s.last_name }}</li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if payments %}
            <div class="table-responsive">
                <table class="table table-sm align-middle">
                    <thead>
                    <tr>
                        <th style="width: 160px;">Paid At</th>
                        <th>Student</th>
                        <th class="text-end" style="width: 160px;">Amount</th>
                        <th>Method</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for p in payments %}
                        <tr>
                            <td>{{ p.paid_at }}</td>
                            <td>{{ p.student.first_name|default:p.student.legal_first_name }} {{ p.student.last_name }}</td>
                            <td class="text-end">${{ p.amount|floatformat:2 }}</td>
                            <td>{{ p.get_paid_via_display }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">No payments recorded for this fee yet.</div>
        {% endif %}

        <div class="mt-4 small text-muted">
            Thank you for your support! Please keep this document for your records.
        </div>

    </div>
    </div>
{% endblock %}
